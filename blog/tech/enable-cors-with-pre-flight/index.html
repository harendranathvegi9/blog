<!DOCTYPE html>
<html lang="en-us">

<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="theme-color" content="#202020">
  
  <!-- Google search console verification -->
  <meta name="google-site-verification" content="MWI4oyhfBl0XmM9yIcmO1Z7pk-vRmALsNYJ1FwKX3iQ" />
  
  <title>
    
    Setting up CORS with pre-flight request handling for development use in Node + Express &middot; Vinay Gopinath
    
  </title>
  <meta name="description" content="Set up express routing to handle CORS + pre-flight request handling in development environment using Nodejs and Express.">
  <meta name="og:description" content="Set up express routing to handle CORS + pre-flight request handling in development environment using Nodejs and Express.">
  <link rel="canonical" href="https://vinaygopinath.me/blog/tech/enable-cors-with-pre-flight/">
  
  <style type="text/css">
  
  h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:bold;line-height:1.25;color:#313131;text-rendering:optimizeLegibility}*{box-sizing:border-box}html{margin:0;padding:0;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5}body{margin:0;padding:0;color:#515151;background-color:#fff}@media (min-width: 38em){html{font-size:20px}}a{color:#268bd2;text-decoration:none}a strong{color:inherit}a:hover{text-decoration:underline}a:focus{text-decoration:underline}h1{font-size:2rem}h2{margin-top:1rem;font-size:1.5rem}h3{margin-top:1.5rem;font-size:1.25rem}h4{margin-top:1rem;font-size:1rem}h5{margin-top:1rem;font-size:1rem}h6{margin-top:1rem;font-size:1rem}p{margin-top:0;margin-bottom:1rem}strong{color:#313131}ul{margin-top:0;margin-bottom:1rem}ol{margin-top:0;margin-bottom:1rem}img{display:block;max-width:100%;margin:0 0 1rem;border-radius:5px}table{margin-bottom:1rem;width:100%;border:1px solid #e5e5e5;border-collapse:collapse}td{padding:.25rem .5rem;border:1px solid #e5e5e5}th{padding:.25rem .5rem;border:1px solid #e5e5e5}.lead{font-size:1.25rem;font-weight:300}.message{margin-bottom:1rem;padding:1rem;color:#717171;background-color:#f9f9f9}.container{max-width:38rem;padding-left:1rem;padding-right:1rem;margin-left:auto;margin-right:auto}tbody tr:nth-child(odd) td{background-color:#f9f9f9}tbody tr:nth-child(odd) th{background-color:#f9f9f9}h1,h2,h3,h4,h5,h6{font-family:Lato,Helvetica,Arial,sans-serif;font-weight:400;color:#313131;letter-spacing:-.025rem}.sidebar-nav-item.active,a.sidebar-nav-item:hover,a.sidebar-nav-item:focus{text-decoration:none;background-color:rgba(255,255,255,0.1);border-color:transparent}html{overflow-x:hidden;font-family:Noto Sans,Georgia,Times New Roman,serif}body{overflow-x:hidden}.wrap{position:relative;width:100%;backface-visibility:hidden;transition:transform .3s ease-in-out}.container{max-width:28rem}@media (min-width: 38em){.container{max-width:32rem}}@media (min-width: 56em){.container{max-width:38rem}}.masthead{padding-top:1rem;padding-bottom:1rem;margin-bottom:3rem;border-bottom:1px solid #eee}.masthead-title{margin-top:0;margin-bottom:0;color:#505050}.masthead-title a{color:#505050}.masthead-title small{font-size:75%;font-weight:400;color:silver;letter-spacing:0}@media (max-width: 48em){.masthead-title{text-align:center}.masthead-title small{display:none}}.sidebar{position:fixed;top:0;bottom:0;left:-14rem;width:14rem;visibility:hidden;overflow-y:auto;font-family:PT Sans,Helvetica,Arial,sans-serif;font-size:.875rem;color:rgba(255,255,255,0.6);background-color:#202020;transition:all .3s ease-in-out;backface-visibility:hidden}.sidebar a{font-weight:normal;color:#fff}@media (min-width: 30em){.sidebar{font-size:.75rem}.pagination{margin:3rem 0}.pagination-item{float:left;width:50%}.pagination-item:first-child{margin-bottom:0;border-top-left-radius:4px;border-bottom-left-radius:4px}.pagination-item:last-child{margin-left:-1px;border-top-right-radius:4px;border-bottom-right-radius:4px}}.sidebar-item{padding:1rem}.sidebar-item p:last-child{margin-bottom:0}.sidebar-nav{border-bottom:1px solid rgba(255,255,255,0.1)}.sidebar-nav-item{display:block;padding:.5rem 1rem;border-top:1px solid rgba(255,255,255,0.1)}a.pagination-item:hover{background-color:#f5f5f5}@media (min-width: 48em){.sidebar-item{padding:1.5rem}.sidebar-nav-item{padding-left:1.5rem;padding-right:1.5rem}}.sidebar-checkbox{position:absolute;opacity:0;user-select:none}.sidebar-toggle{position:absolute;top:.8rem;left:1rem;display:block;padding:.25rem .75rem;color:#505050;background-color:#fff;border-radius:.25rem;cursor:pointer;backface-visibility:hidden;transition:transform .3s ease-in-out}.sidebar-toggle:before{display:inline-block;width:1rem;height:.75rem;content:"";background-image:linear-gradient(to bottom, #505050, #505050 20%, #fff 20%, #fff 40%, #505050 40%, #505050 60%, #fff 60%, #fff 80%, #505050 80%, #505050 100%)}.sidebar-toggle:active{color:#fff;background-color:#505050}.sidebar-toggle:active:before{background-image:linear-gradient(to bottom, #fff, #fff 20%, #505050 20%, #505050 40%, #fff 40%, #fff 60%, #505050 60%, #505050 80%, #fff 80%, #fff 100%)}@media (min-width: 30.1em){.sidebar-toggle{position:fixed}}@media print{.sidebar-toggle{display:none}}.page{margin-bottom:4em}.post{margin-bottom:2em}.post:first-child{margin-top:2em}.page-title{text-transform:capitalize;color:#313131;margin-top:0}.post-title{color:#313131;margin-top:0}.post-title a{color:#313131}.post-date{display:block;margin-top:-.5rem;margin-bottom:1rem;color:#9a9a9a;font-size:0.65rem;text-transform:uppercase}.pagination{overflow:hidden;margin-left:-1rem;margin-right:-1rem;font-family:PT Sans,Helvetica,Arial,sans-serif;color:#ccc;text-align:center}.pagination-item{display:block;padding:1rem;border:1px solid #eee}.pagination-item:first-child{margin-bottom:-1px}.post{color:#212121}.post p,.post li{text-align:justify;font-size:16px;line-height:28px}.post li{margin-bottom:10px}.home-container{-webkit-display:-webkit-box;-webkit-display:-webkit-flex;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-justify-content:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;height:100vh;width:100vw}.home{text-align:center;width:50vw;height:30vh;transition:all 0.3s ease-in-out}.home .btn{font-family:inherit;font-size:12px;background:0;cursor:pointer;padding:25px 10px;display:inline-block;margin:15px 10px;text-transform:uppercase;letter-spacing:1px;font-weight:700;outline:0;position:relative;border:2px solid #0e83cd;color:#0e83cd;-webkit-transition:all .3s;-moz-transition:all .3s;transition:all .3s}.home .btn:hover,.home .btn:active{color:#fff;background:#0e83cd}.home .btn:hover::after,.home .btn:active::after{width:100%}.home .btn::after{content:'';position:absolute;z-index:-1;-webkit-transition:all .3s;-moz-transition:all .3s;transition:all .3s;height:100%;top:0;left:0;background:#fff}@media only screen and (max-device-width: 480px){.home{width:90vw;height:90vh}}@media only screen and (min-device-width: 481px) and (max-device-width: 990px){.home{width:75vw;height:75vh}}@media only screen and (min-device-width: 991px){.home{width:60vw;height:60vh}}

  </style>
  
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/public/icons/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/public/icons/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/public/icons/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/icons/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/public/icons/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/public/icons/apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="/public/icons/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/public/icons/favicon-16x16.png" sizes="16x16" />
  <link rel="shortcut icon" href="/public/icons/favicon.ico">
  <meta name="application-name" content="Vinay Gopinath &middot; Adventures with technology and travel" />
  <meta name="msapplication-TileColor" content="#202020" />
  <meta name="msapplication-TileImage" content="/public/icons/mstile-144x144.png" />
  
  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


<body>
  <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Adventures with technology and travel</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>
    <a class="sidebar-nav-item  active" href="/blog/tech/">Tech blog</a>
    <a class="sidebar-nav-item " href="/blog/travel/">Travel blog</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2016. All rights reserved.
    </p>
  </div>
</div>


<!-- Wrap is the content to shift when toggling the sidebar. We wrap the
  content to avoid any CSS collisions with our real content. -->
<div class="wrap">
    <div class="masthead">
        <div class="container">
            <h3 class="masthead-title">
          <a href="/" title="Home">Vinay Gopinath</a>
          <small>Adventures with technology and travel</small>
        </h3>
        </div>
    </div>

    <div class="container content">
        <div class="post">
  <h2 class="post-title">Setting up CORS with pre-flight request handling for development use in Node + Express</h2>
  <span class="post-date">23 May 2016</span>
  <p>“Cross-Origin Resource Sharing” (CORS)-related errors are a common occurrence while developing a site with a separate frontend and API backend. While the <a href="https://github.com/expressjs/cors">cors module</a> can set headers and respond to pre-flight requests, I didn’t find any documentation to set it up only in the Node development environment (assuming you don’t want to expose your APIs to requests from multiple domains).</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'env'</span><span class="p">)</span> <span class="o">===</span> <span class="s1">'development'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Enabling CORS'</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s1">'Access-Control-Allow-Origin'</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s1">'Access-Control-Allow-Methods'</span><span class="p">,</span> <span class="s1">'GET,PUT,POST,DELETE,PATCH,OPTIONS'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s1">'Access-Control-Allow-Headers'</span><span class="p">,</span> <span class="s1">'Content-Type, Authorization, Content-Length, X-Requested-With'</span><span class="p">);</span> <span class="c1">//Add other headers used in your requests</span>

    <span class="k">if</span> <span class="p">(</span><span class="s1">'OPTIONS'</span> <span class="o">==</span> <span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">sendStatus</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">//Set up express routes here</span>
</code></pre>
</div>
<p>This enables CORS for all Express routes and responds to pre-flight OPTIONS requests with HTTP status OK (200) only during development. If you haven’t already set your <code class="highlighter-rouge">NODE_ENV</code> to <code class="highlighter-rouge">development</code>, you can do so and start your server like so</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">NODE_ENV</span><span class="o">=</span>development node index.js
</code></pre>
</div>

</div>

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
      "@type": "ListItem",
      "position": 1,
      "item": {
        "@id": "https://vinaygopinath.me",
        "name": "Home"
      }
    },{
      "@type": "ListItem",
      "position": 2,
      "item": {
        "@id": "https://vinaygopinath.me/tech",
        "name": "Tech"
      }
    },{
      "@type": "ListItem",
      "position": 3,
      "item": {
        "@id": "https://vinaygopinath.me/blog/tech/enable-cors-with-pre-flight/",
        "name": "Setting up CORS with pre-flight request handling for development use in Node + Express"
      }
    }]
  }
</script>

<div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    this.page.url = 'https://vinaygopinath.me/blog/tech/enable-cors-with-pre-flight/';
    this.page.identifier = '/blog/tech/enable-cors-with-pre-flight/';
  };
  (function() {
    var d = document, s = d.createElement('script');
    s.src = '//vinaygopinath.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>You don't seem to have Javascript enabled - To participate in the discussion, consider allowing Javascript on this site</noscript>

<!--<div class="related">
<h2>Related Posts</h2>
<ul class="related-posts">

<li>
<h3>
<a href="/blog/travel/overheard-in-lodz/">
Overheard in Łódź
<small>25 Aug 2016</small>
</a>
</h3>
</li>

<li>
<h3>
<a href="/blog/tech/seo-in-angular2-with-ng2-meta/">
SEO in Angular2 with ng2-meta
<small>25 Jul 2016</small>
</a>
</h3>
</li>

<li>
<h3>
<a href="/blog/tech/nomad-couple/">
Nomad Couple
<small>25 Jul 2016</small>
</a>
</h3>
</li>

</ul>
</div>-->

    </div>
</div>

<label for="sidebar-checkbox" class="sidebar-toggle"></label>

<script>
    (function(document) {
      var toggle = document.querySelector('.sidebar-toggle');
      var sidebar = document.querySelector('#sidebar');
      var checkbox = document.querySelector('#sidebar-checkbox');

      document.addEventListener('click', function(e) {
        var target = e.target;

        if (!checkbox.checked ||
          sidebar.contains(target) ||
          (target === checkbox || target === toggle)) return;

        checkbox.checked = false;
      }, false);
    })(document);
</script>
  
  <link rel="stylesheet" href="/public/styles/site.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:400%7CLato:400">
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-78016218-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
</body>

</html>
